(()=>{"use strict";const e={init(e){if(!e)throw e;return this.el=e,this},on(e,t){return this.el.addEventListener(e,t),this},emit(e,t){const i=new CustomEvent(e,{detail:t});return this.el.dispatchEvent(i),this},hide(){return this.el.style.display="none",this},show(){return this.el.style.display="",this}},t=Object.create(e);t.setup=function(e){return this.init(e),this.inputEl=e.querySelector("[type=text]"),this.resetEl=e.querySelector("[type=reset"),this.showResetBtn(!1),this.bindEvents(),this},t.showResetBtn=function(e=!0){this.resetEl.style.display=e?"block":"none"},t.bindEvents=function(){this.on("submit",(e=>e.preventDefault())),this.inputEl.addEventListener("keyup",(e=>this.onKeyup(e))),this.resetEl.addEventListener("click",(e=>this.onClickReset()))},t.onKeyup=function(e){this.showResetBtn(this.inputEl.value.length),this.inputEl.value.length||this.emit("@reset"),13===e.keyCode&&this.emit("@submit",{input:this.inputEl.value})},t.onClickReset=function(){this.emit("@reset"),this.showResetBtn(!1)},t.setValue=function(e=""){this.inputEl.value=e,this.showResetBtn(this.inputEl.value.length)};const i=t,s=Object.create(e);s.messages={NO_RESULT:"검색 결과가 없습니다"},s.setup=function(e){this.init(e)},s.render=function(e=[]){console.log("[ResultView]","render()",e),this.el.innerHTML=e.length?this.getSearchResultsHtml(e):this.messages.NO_RESULT,this.show()},s.getSearchResultsHtml=function(e){return e.reduce(((e,t)=>e+this.getSearchItemHtml(t)),"<ul>")+"</ul>"},s.getSearchItemHtml=function(e){return`<li>\n    <img src="${e.image}" />\n    <p>${e.name}</p>\n  </li>`};const n=s,r=Object.create(e);r.tabNames={recommand:"추천 검색어",recent:"최근 검색어"},r.setup=function(e){return this.init(e),this.bindClick(),this},r.setActiveTab=function(e){Array.from(this.el.children).forEach((t=>{t.className=t.innerHTML===e?"active":""})),this.show()},r.bindClick=function(){Array.from(this.el.children).forEach((e=>{e.addEventListener("click",(t=>this.onClick(e.innerHTML)))}))},r.onClick=function(e){this.setActiveTab(e),this.emit("@change",{tabName:e})};const o=r,h=Object.create(e);h.messages={NO_KEYWORDS:"추천 검색어가 없습니다"},h.setup=function(e){return this.init(e),this},h.render=function(e=[]){return this.el.innerHTML=e.length?this.getKeywordsHtml(e):this.messages.NO_KEYWORDS,this.show(),this.bindClickEvent(),this},h.getKeywordsHtml=function(e){return e.reduce(((e,t,i)=>e+`<li data-keyword="${t.keyword}"><span class="number">${i+1}</span>${t.keyword}</li>`),'<ul class="list">')+"</ul>"},h.bindClickEvent=function(){Array.from(this.el.querySelectorAll("li")).forEach((e=>{e.addEventListener("click",(e=>this.onClickKeyword(e)))}))},h.onClickKeyword=function(e){const{keyword:t}=e.currentTarget.dataset;this.emit("@click",{keyword:t})};const a=h,c=Object.create(a);c.messages.NO_KEYWORDS="검색 이력이 없습니다",c.getKeywordsHtml=function(e){return e.reduce(((e,t)=>e+`<li data-keyword="${t.keyword}">\n      ${t.keyword} \n      <span class="date">${t.date}</span>\n      <button class="btn-remove"></button>\n      </li>`),'<ul class="list">')+"</ul>"},c.bindRemoveBtn=function(){Array.from(this.el.querySelectorAll("button.btn-remove")).forEach((e=>{e.addEventListener("click",(t=>{t.stopPropagation(),this.onRemove(e.parentElement.dataset.keyword)}))}))},c.onRemove=function(e){this.emit("@remove",{keyword:e})};const l=c,d=[{id:1,name:"[키친르쎌] 홈메이드 칠리소스 포크립 650g",image:"https://dcx-tech.s3.ap-northeast-2.amazonaws.com/profile_img/f262da12f2dbdb2b25b8.png"},{id:2,name:"[키친르쎌] 이탈리아 파티 세트 3~4인분",image:"https://dcx-tech.s3.ap-northeast-2.amazonaws.com/profile_img/588f72bbe7c1d2a39af5.png"}],u=e=>new Promise((e=>{setTimeout((()=>{e(d)}),200)})),m={data:[{keyword:"이탈리아"},{keyword:"세프의요리"},{keyword:"제철"},{keyword:"홈파티"}],list(){return new Promise((e=>{setTimeout((()=>{e(this.data)}),200)}))}},y={data:[{keyword:"검색기록2",date:"12.03"},{keyword:"검색기록1",date:"12.02"},{keyword:"검색기록0",date:"12.01"}],list(){return Promise.resolve(this.data)},add(e=""){(e=e.trim())&&(this.data.some((t=>t.keyword===e))&&this.remove(e),this.data=[{keyword:e,date:"12.31"},...this.data])},remove(e){this.data=this.data.filter((t=>t.keyword!==e))}},w="[MainController]",k={init(){i.setup(document.querySelector("form")).on("@submit",(e=>this.onSubmit(e.detail.input))).on("@reset",(e=>this.onResetForm())),o.setup(document.querySelector("#tabs")).on("@change",(e=>this.onChangeTab(e.detail.tabName))),a.setup(document.querySelector("#search-keyword")).on("@click",(e=>this.onClickKeyword(e.detail.keyword))),l.setup(document.querySelector("#search-history")).on("@click",(e=>this.onClickHistory(e.detail.keyword))).on("@remove",(e=>this.onRemoveHistory(e.detail.keyword))),n.setup(document.querySelector("#search-result")),this.selectedTab="추천 검색어",this.renderView()},search(e){i.setValue(e),u(e).then((e=>{this.onSearchResult(e)}))},renderView(){console.log(w,"rednerView()"),o.setActiveTab(this.selectedTab),"추천 검색어"===this.selectedTab?(this.fetchSearchKeyword(),l.hide()):(this.fetchSearchHistory(),a.hide()),n.hide()},fetchSearchKeyword(){m.list().then((e=>{a.render(e)}))},fetchSearchHistory(){y.list().then((e=>{l.render(e).bindRemoveBtn()}))},onSubmit(e){console.log(w,"onSubmit()",e),this.search(e)},onResetForm(){console.log(w,"onResetForm()"),this.renderView()},onSearchResult(e){o.hide(),a.hide(),l.hide(),n.render(e)},onChangeTab(e){this.selectedTab=e,this.renderView()},onClickKeyword(e){this.search(e)},onClickHistory(e){this.search(e)},onRemoveHistory(e){y.remove(e),this.renderView()}};document.addEventListener("DOMContentLoaded",(()=>{k.init()}))})();